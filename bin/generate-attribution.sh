#!/bin/bash
# Generate ATTRIBUTION.md from ATTRIBUTION.json
# SPDX-License-Identifier: MIT

set -euo pipefail

cat > ATTRIBUTION.md << 'EOF'
# Document Attribution

<!-- WARNING: This file is autogenerated from ATTRIBUTION.json - DO NOT EDIT MANUALLY -->

This file tracks all donated documents, their authors, licenses, and sources.

---

EOF

jq -r '.[] | "## \(.title)\n\n- **Format**: `\(.format)`\n- **Path**: `\(.path)`\n- **Author**: \(.author)\n- **License**: \(.license)\n- **Source**: \(.source)\n- **Tags**: \(.tags | map("`" + . + "`") | join(", "))\n- **Donated**: \(.donated)\n- **Notes**: \(.notes)\n\n---\n"' ATTRIBUTION.json >> ATTRIBUTION.md

# Remove trailing blank lines and final separator
sed -i -z 's/\n---\n*$/\n/' ATTRIBUTION.md

echo "âœ“ Generated ATTRIBUTION.md from ATTRIBUTION.json"
